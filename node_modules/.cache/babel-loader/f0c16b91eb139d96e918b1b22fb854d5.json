{"remainingRequest":"/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/node_modules/thread-loader/dist/cjs.js!/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/node_modules/babel-loader/lib/index.js!/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/src/views/publish/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/src/views/publish/index.vue","mtime":1581825653371},{"path":"/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlIjsKLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0IGhlYWRlcmJhciBmcm9tICdAL2NvbXBvbmVudHMvaGVhZGVyYmFyJzsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdwdWJsaXNoJywKICBjb21wb25lbnRzOiB7CiAgICBoZWFkZXJiYXI6IGhlYWRlcmJhcgogIH0sCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHBvc3RDb250ZW50OiAnJywKICAgICAgdGV4dENvdW50OiAwLAogICAgICBpbWFnZUxpc3Q6IFtdCiAgICB9OwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIGltZ1N0eWxlOiBmdW5jdGlvbiBpbWdTdHlsZSgpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGJhY2tncm91bmRJbWFnZTogJ3VybCgnICsgaXRlbS5iYXNlNjQgKyAnKScKICAgICAgICB9OwogICAgICB9OwogICAgfSwKICAgIGN1cnJlbnRVc2VyOiBmdW5jdGlvbiBjdXJyZW50VXNlcigpIHsKICAgICAgLy8g6K6h566X5bGe5oCn6I635Y+WdnVleOS4reeahGN1cnJlbnRVc2Vy5YC8CiAgICAgIHJldHVybiB0aGlzLiRzdG9yZS5zdGF0ZS5jdXJyZW50VXNlcjsKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIG9uaW5wdXQ6IGZ1bmN0aW9uIG9uaW5wdXQoKSB7CiAgICAgIHRoaXMudGV4dENvdW50ID0gdGhpcy5wb3N0Q29udGVudC5sZW5ndGg7CiAgICB9LAogICAgb3BlbkZpbGVVcGxvYWRlcjogZnVuY3Rpb24gb3BlbkZpbGVVcGxvYWRlcigpIHsKICAgICAgdGhpcy4kcmVmcy5maWxlVXBsb2FkZXIuY2xpY2soKTsKICAgIH0sCiAgICBmaWxlQ2hhbmdlOiBmdW5jdGlvbiBmaWxlQ2hhbmdlKGV2ZW50KSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICB2YXIgZmlsZXMgPSBldmVudC50YXJnZXQuZmlsZXM7IC8v6I635Y+W5paH5Lu25a+56LGhCgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZpbGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZXNbaV0pOyAvL+WwhuWbvueJh+i9rOaNouaIkGJhc2U2NOWtl+espuS4sgoKICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHZhciBpbWFnZSA9IG5ldyBJbWFnZSgpOyAvL+i9rOaNouaIkEltYWdl5a+56LGh77yM5Li65LqG6I635Y+W5Zu+54mH5aSn5bCPCgogICAgICAgICAgaW1hZ2Uub25sb2FkID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAvLyDkv53lrZjliLDlm77niYfliJfooajmlbDnu4TkuK0KICAgICAgICAgICAgX3RoaXMuaW1hZ2VMaXN0LnB1c2goewogICAgICAgICAgICAgIGJhc2U2NDogZS50YXJnZXQucmVzdWx0LAogICAgICAgICAgICAgIHdpZHRoOiBpbWFnZS53aWR0aCwKICAgICAgICAgICAgICBoZWlnaHQ6IGltYWdlLmhlaWdodAogICAgICAgICAgICB9KTsKICAgICAgICAgIH07CgogICAgICAgICAgaW1hZ2Uuc3JjID0gZS50YXJnZXQucmVzdWx0OwogICAgICAgIH07CiAgICAgIH0gLy8g5q+P5qyh6YCJ5a6M5Zu+54mH5ZCO6KaB5riF6ZmkdmFsdWUKCgogICAgICBldmVudC50YXJnZXQudmFsdWUgPSBudWxsOwogICAgfSwKICAgIGRlbGV0ZUltYWdlOiBmdW5jdGlvbiBkZWxldGVJbWFnZShpbmRleCkgewogICAgICB0aGlzLmltYWdlTGlzdC5zcGxpY2UoaW5kZXgsIDEpOwogICAgfSwKICAgIHB1Ymxpc2g6IGZ1bmN0aW9uIHB1Ymxpc2goKSB7CiAgICAgIC8vIOWbvueJh+aVsOaNrgogICAgICB2YXIgcGljcyA9IFtdOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmltYWdlTGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgIHBpY3MucHVzaCh7CiAgICAgICAgICB1cmw6IHRoaXMuaW1hZ2VMaXN0W2ldLmJhc2U2NCwKICAgICAgICAgIGdlbzogewogICAgICAgICAgICB3aWR0aDogdGhpcy5pbWFnZUxpc3RbaV0ud2lkdGgsCiAgICAgICAgICAgIGhlaWdodDogdGhpcy5pbWFnZUxpc3RbaV0uaGVpZ2h0CiAgICAgICAgICB9LAogICAgICAgICAgbGFyZ2U6IHsKICAgICAgICAgICAgdXJsOiB0aGlzLmltYWdlTGlzdFtpXS5iYXNlNjQKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSAvLyDmraPmlofmlbDmja4KCgogICAgICB2YXIgb2JqID0gewogICAgICAgIG1ibG9nOiB7CiAgICAgICAgICBpZDogRGF0ZS5ub3coKSwKICAgICAgICAgIHJlcG9zdHNfY291bnQ6IDAsCiAgICAgICAgICBjb21tZW50c19jb3VudDogMCwKICAgICAgICAgIGF0dGl0dWRlc19jb3VudDogMCwKICAgICAgICAgIHNvdXJjZTogJ+W+ruWNmm1vYmlsZeeJiCcsCiAgICAgICAgICB0ZXh0OiB0aGlzLnBvc3RDb250ZW50LAogICAgICAgICAgcGljczogcGljcywKICAgICAgICAgIHVzZXI6IHsKICAgICAgICAgICAgc2NyZWVuX25hbWU6IHRoaXMuY3VycmVudFVzZXIuc2NyZWVuX25hbWUsCiAgICAgICAgICAgIHByb2ZpbGVfaW1hZ2VfdXJsOiB0aGlzLmN1cnJlbnRVc2VyLnByb2ZpbGVfaW1hZ2VfdXJsLAogICAgICAgICAgICBiYWRnZTogewogICAgICAgICAgICAgIHVzZXJfbmFtZV9jZXJ0aWZpY2F0ZTogdGhpcy5jdXJyZW50VXNlci52ZXJpZmllZAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OwogICAgICB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnYWRkUG9zdCcsIG9iaik7CiAgICAgIG11aS50b2FzdCgn5Y+R6KGo5oiQ5YqfJyk7CiAgICAgIHRoaXMuJHJvdXRlci5iYWNrKCk7CiAgICB9CiAgfQp9Ow=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"container\">\n    <headerbar useRightBtn=\"发表\" :useBack=\"true\" title=\"发表\" @rightBtnClick=\"publish\"></headerbar>\n    <textarea id=\"postContent\"\n      maxlength=\"300\"\n      placeholder=\"分享新鲜事...\"\n      @input=\"oninput\"\n      v-model=\"postContent\"></textarea>\n    <div class=\"text-count\"><span class=\"left-count\">{{textCount}}</span>/300</div>\n    <div class=\"selected-images\">\n      <div class=\"image-item\" v-for=\"(item,index) in imageList\" :key=\"index\" :style=\"imgStyle(item)\">\n        <div class=\"delete-icon\" @click=\"deleteImage(index)\"></div>\n      </div>\n      <div class=\"plus-image\" @click=\"openFileUploader\"></div>\n    </div>\n    <input type=\"file\" id=\"fileUploader\" ref=\"fileUploader\"\n       @change=\"fileChange\"\n       accept=\"image/*\"\n       multiple=\"multiple\"/>\n  </div>\n</template>\n\n<script>\n\nimport headerbar from '@/components/headerbar'\nexport default {\n  name: 'publish',\n  components:{\n    headerbar\n  },\n  data(){\n    return {\n      postContent: '',\n      textCount: 0,\n      imageList:[]\n    }\n  },\n  computed: {\n    imgStyle () {\n      return item => {\n        return {\n          backgroundImage: 'url(' + item.base64 + ')'\n        }\n      }\n    },\n    currentUser () { // 计算属性获取vuex中的currentUser值\n      return this.$store.state.currentUser\n    }\n  },\n  methods:{\n    oninput(){\n      this.textCount = this.postContent.length\n    },\n    openFileUploader(){\n      this.$refs.fileUploader.click()\n    },\n    fileChange (event) {\n      let files = event.target.files; //获取文件对象\n      for (let i = 0; i < files.length; i++) {\n        var reader = new FileReader();\n        reader.readAsDataURL(files[i]); //将图片转换成base64字符串\n        reader.onload = (e) => {\n          let image = new Image() //转换成Image对象，为了获取图片大小\n          image.onload = () => {\n            // 保存到图片列表数组中\n            this.imageList.push({\n              base64: e.target.result,\n              width: image.width,\n              height: image.height\n            })\n          }\n          image.src = e.target.result\n        }\n      }\n      // 每次选完图片后要清除value\n      event.target.value = null\n    },\n    deleteImage(index){\n      this.imageList.splice(index, 1)\n    },\n    publish(){\n      // 图片数据\n      let pics = [];\n      for (let i = 0 ; i < this.imageList.length ; i++) {\n        pics.push({\n          url: this.imageList[i].base64,\n          geo:{\n            width: this.imageList[i].width,\n            height: this.imageList[i].height\n          },\n          large:{\n            url: this.imageList[i].base64\n          }\n        })\n      }\n\n      // 正文数据\n      let obj = {\n        mblog: {\n          id: Date.now(),\n          reposts_count: 0,\n          comments_count: 0,\n          attitudes_count: 0,\n          source: '微博mobile版',\n          text: this.postContent,\n          pics: pics,\n          user: {\n            screen_name: this.currentUser.screen_name,\n            profile_image_url: this.currentUser.profile_image_url,\n            badge:{\n              user_name_certificate: this.currentUser.verified\n            }\n          }\n        }\n      }\n\n      this.$store.dispatch('addPost', obj)\n      mui.toast('发表成功')\n      this.$router.back()\n    }\n  }\n\n}\n</script>\n<style scoped>\n.container {\n  position: fixed;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  top: 0;\n  background-color: #fff;\n}\n#postContent {\n  margin-top: 45px;\n  border: none;\n  font-size: 16px;\n  width: 100%;\n  height: 200px;\n  box-sizing: border-box;\n}\n.text-count {\n  font-size: 14px;\n  color: #707070;\n  position: absolute;\n  right: 20px;\n  top: 230px;\n}\n#fileUploader {\n  display: none;\n}\n.selected-images {\n  display: flex;\n  flex-wrap: wrap;\n}\n.image-item {\n  width: 100px;\n  height: 100px;\n  position: relative;\n  background-size: cover;\n  background-position: center center;\n  background-repeat: no-repeat;\n  margin-left: 20px;\n  margin-bottom: 20px;\n}\n.plus-image {\n  width: 100px;\n  height: 100px;\n  position: relative;\n  background-size: 24px 24px;\n  background-position: center center;\n  background-repeat: no-repeat;\n  background-image: url('./imgs/plus.png');\n  margin-left: 20px;\n  border: 1px dashed #aaa;\n}\n.delete-icon {\n  position: absolute;\n  width: 15px;\n  height: 15px;\n  background-image: url('./imgs/delete.png');\n  background-size: cover;\n  top: -7px;\n  right: -7px;\n}\n</style>\n"],"sourceRoot":"src/views/publish"}]}