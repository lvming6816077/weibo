{"remainingRequest":"/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/src/views/publish/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/src/views/publish/index.vue","mtime":1581825653371},{"path":"/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCgppbXBvcnQgaGVhZGVyYmFyIGZyb20gJ0AvY29tcG9uZW50cy9oZWFkZXJiYXInCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAncHVibGlzaCcsCiAgY29tcG9uZW50czp7CiAgICBoZWFkZXJiYXIKICB9LAogIGRhdGEoKXsKICAgIHJldHVybiB7CiAgICAgIHBvc3RDb250ZW50OiAnJywKICAgICAgdGV4dENvdW50OiAwLAogICAgICBpbWFnZUxpc3Q6W10KICAgIH0KICB9LAogIGNvbXB1dGVkOiB7CiAgICBpbWdTdHlsZSAoKSB7CiAgICAgIHJldHVybiBpdGVtID0+IHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgYmFja2dyb3VuZEltYWdlOiAndXJsKCcgKyBpdGVtLmJhc2U2NCArICcpJwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGN1cnJlbnRVc2VyICgpIHsgLy8g6K6h566X5bGe5oCn6I635Y+WdnVleOS4reeahGN1cnJlbnRVc2Vy5YC8CiAgICAgIHJldHVybiB0aGlzLiRzdG9yZS5zdGF0ZS5jdXJyZW50VXNlcgogICAgfQogIH0sCiAgbWV0aG9kczp7CiAgICBvbmlucHV0KCl7CiAgICAgIHRoaXMudGV4dENvdW50ID0gdGhpcy5wb3N0Q29udGVudC5sZW5ndGgKICAgIH0sCiAgICBvcGVuRmlsZVVwbG9hZGVyKCl7CiAgICAgIHRoaXMuJHJlZnMuZmlsZVVwbG9hZGVyLmNsaWNrKCkKICAgIH0sCiAgICBmaWxlQ2hhbmdlIChldmVudCkgewogICAgICBsZXQgZmlsZXMgPSBldmVudC50YXJnZXQuZmlsZXM7IC8v6I635Y+W5paH5Lu25a+56LGhCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmlsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlc1tpXSk7IC8v5bCG5Zu+54mH6L2s5o2i5oiQYmFzZTY05a2X56ym5LiyCiAgICAgICAgcmVhZGVyLm9ubG9hZCA9IChlKSA9PiB7CiAgICAgICAgICBsZXQgaW1hZ2UgPSBuZXcgSW1hZ2UoKSAvL+i9rOaNouaIkEltYWdl5a+56LGh77yM5Li65LqG6I635Y+W5Zu+54mH5aSn5bCPCiAgICAgICAgICBpbWFnZS5vbmxvYWQgPSAoKSA9PiB7CiAgICAgICAgICAgIC8vIOS/neWtmOWIsOWbvueJh+WIl+ihqOaVsOe7hOS4rQogICAgICAgICAgICB0aGlzLmltYWdlTGlzdC5wdXNoKHsKICAgICAgICAgICAgICBiYXNlNjQ6IGUudGFyZ2V0LnJlc3VsdCwKICAgICAgICAgICAgICB3aWR0aDogaW1hZ2Uud2lkdGgsCiAgICAgICAgICAgICAgaGVpZ2h0OiBpbWFnZS5oZWlnaHQKICAgICAgICAgICAgfSkKICAgICAgICAgIH0KICAgICAgICAgIGltYWdlLnNyYyA9IGUudGFyZ2V0LnJlc3VsdAogICAgICAgIH0KICAgICAgfQogICAgICAvLyDmr4/mrKHpgInlrozlm77niYflkI7opoHmuIXpmaR2YWx1ZQogICAgICBldmVudC50YXJnZXQudmFsdWUgPSBudWxsCiAgICB9LAogICAgZGVsZXRlSW1hZ2UoaW5kZXgpewogICAgICB0aGlzLmltYWdlTGlzdC5zcGxpY2UoaW5kZXgsIDEpCiAgICB9LAogICAgcHVibGlzaCgpewogICAgICAvLyDlm77niYfmlbDmja4KICAgICAgbGV0IHBpY3MgPSBbXTsKICAgICAgZm9yIChsZXQgaSA9IDAgOyBpIDwgdGhpcy5pbWFnZUxpc3QubGVuZ3RoIDsgaSsrKSB7CiAgICAgICAgcGljcy5wdXNoKHsKICAgICAgICAgIHVybDogdGhpcy5pbWFnZUxpc3RbaV0uYmFzZTY0LAogICAgICAgICAgZ2VvOnsKICAgICAgICAgICAgd2lkdGg6IHRoaXMuaW1hZ2VMaXN0W2ldLndpZHRoLAogICAgICAgICAgICBoZWlnaHQ6IHRoaXMuaW1hZ2VMaXN0W2ldLmhlaWdodAogICAgICAgICAgfSwKICAgICAgICAgIGxhcmdlOnsKICAgICAgICAgICAgdXJsOiB0aGlzLmltYWdlTGlzdFtpXS5iYXNlNjQKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICB9CgogICAgICAvLyDmraPmlofmlbDmja4KICAgICAgbGV0IG9iaiA9IHsKICAgICAgICBtYmxvZzogewogICAgICAgICAgaWQ6IERhdGUubm93KCksCiAgICAgICAgICByZXBvc3RzX2NvdW50OiAwLAogICAgICAgICAgY29tbWVudHNfY291bnQ6IDAsCiAgICAgICAgICBhdHRpdHVkZXNfY291bnQ6IDAsCiAgICAgICAgICBzb3VyY2U6ICflvq7ljZptb2JpbGXniYgnLAogICAgICAgICAgdGV4dDogdGhpcy5wb3N0Q29udGVudCwKICAgICAgICAgIHBpY3M6IHBpY3MsCiAgICAgICAgICB1c2VyOiB7CiAgICAgICAgICAgIHNjcmVlbl9uYW1lOiB0aGlzLmN1cnJlbnRVc2VyLnNjcmVlbl9uYW1lLAogICAgICAgICAgICBwcm9maWxlX2ltYWdlX3VybDogdGhpcy5jdXJyZW50VXNlci5wcm9maWxlX2ltYWdlX3VybCwKICAgICAgICAgICAgYmFkZ2U6ewogICAgICAgICAgICAgIHVzZXJfbmFtZV9jZXJ0aWZpY2F0ZTogdGhpcy5jdXJyZW50VXNlci52ZXJpZmllZAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnYWRkUG9zdCcsIG9iaikKICAgICAgbXVpLnRvYXN0KCflj5HooajmiJDlip8nKQogICAgICB0aGlzLiRyb3V0ZXIuYmFjaygpCiAgICB9CiAgfQoKfQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAwBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA","file":"index.vue","sourceRoot":"src/views/publish","sourcesContent":["<template>\n  <div class=\"container\">\n    <headerbar useRightBtn=\"发表\" :useBack=\"true\" title=\"发表\" @rightBtnClick=\"publish\"></headerbar>\n    <textarea id=\"postContent\"\n      maxlength=\"300\"\n      placeholder=\"分享新鲜事...\"\n      @input=\"oninput\"\n      v-model=\"postContent\"></textarea>\n    <div class=\"text-count\"><span class=\"left-count\">{{textCount}}</span>/300</div>\n    <div class=\"selected-images\">\n      <div class=\"image-item\" v-for=\"(item,index) in imageList\" :key=\"index\" :style=\"imgStyle(item)\">\n        <div class=\"delete-icon\" @click=\"deleteImage(index)\"></div>\n      </div>\n      <div class=\"plus-image\" @click=\"openFileUploader\"></div>\n    </div>\n    <input type=\"file\" id=\"fileUploader\" ref=\"fileUploader\"\n       @change=\"fileChange\"\n       accept=\"image/*\"\n       multiple=\"multiple\"/>\n  </div>\n</template>\n\n<script>\n\nimport headerbar from '@/components/headerbar'\nexport default {\n  name: 'publish',\n  components:{\n    headerbar\n  },\n  data(){\n    return {\n      postContent: '',\n      textCount: 0,\n      imageList:[]\n    }\n  },\n  computed: {\n    imgStyle () {\n      return item => {\n        return {\n          backgroundImage: 'url(' + item.base64 + ')'\n        }\n      }\n    },\n    currentUser () { // 计算属性获取vuex中的currentUser值\n      return this.$store.state.currentUser\n    }\n  },\n  methods:{\n    oninput(){\n      this.textCount = this.postContent.length\n    },\n    openFileUploader(){\n      this.$refs.fileUploader.click()\n    },\n    fileChange (event) {\n      let files = event.target.files; //获取文件对象\n      for (let i = 0; i < files.length; i++) {\n        var reader = new FileReader();\n        reader.readAsDataURL(files[i]); //将图片转换成base64字符串\n        reader.onload = (e) => {\n          let image = new Image() //转换成Image对象，为了获取图片大小\n          image.onload = () => {\n            // 保存到图片列表数组中\n            this.imageList.push({\n              base64: e.target.result,\n              width: image.width,\n              height: image.height\n            })\n          }\n          image.src = e.target.result\n        }\n      }\n      // 每次选完图片后要清除value\n      event.target.value = null\n    },\n    deleteImage(index){\n      this.imageList.splice(index, 1)\n    },\n    publish(){\n      // 图片数据\n      let pics = [];\n      for (let i = 0 ; i < this.imageList.length ; i++) {\n        pics.push({\n          url: this.imageList[i].base64,\n          geo:{\n            width: this.imageList[i].width,\n            height: this.imageList[i].height\n          },\n          large:{\n            url: this.imageList[i].base64\n          }\n        })\n      }\n\n      // 正文数据\n      let obj = {\n        mblog: {\n          id: Date.now(),\n          reposts_count: 0,\n          comments_count: 0,\n          attitudes_count: 0,\n          source: '微博mobile版',\n          text: this.postContent,\n          pics: pics,\n          user: {\n            screen_name: this.currentUser.screen_name,\n            profile_image_url: this.currentUser.profile_image_url,\n            badge:{\n              user_name_certificate: this.currentUser.verified\n            }\n          }\n        }\n      }\n\n      this.$store.dispatch('addPost', obj)\n      mui.toast('发表成功')\n      this.$router.back()\n    }\n  }\n\n}\n</script>\n<style scoped>\n.container {\n  position: fixed;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  top: 0;\n  background-color: #fff;\n}\n#postContent {\n  margin-top: 45px;\n  border: none;\n  font-size: 16px;\n  width: 100%;\n  height: 200px;\n  box-sizing: border-box;\n}\n.text-count {\n  font-size: 14px;\n  color: #707070;\n  position: absolute;\n  right: 20px;\n  top: 230px;\n}\n#fileUploader {\n  display: none;\n}\n.selected-images {\n  display: flex;\n  flex-wrap: wrap;\n}\n.image-item {\n  width: 100px;\n  height: 100px;\n  position: relative;\n  background-size: cover;\n  background-position: center center;\n  background-repeat: no-repeat;\n  margin-left: 20px;\n  margin-bottom: 20px;\n}\n.plus-image {\n  width: 100px;\n  height: 100px;\n  position: relative;\n  background-size: 24px 24px;\n  background-position: center center;\n  background-repeat: no-repeat;\n  background-image: url('./imgs/plus.png');\n  margin-left: 20px;\n  border: 1px dashed #aaa;\n}\n.delete-icon {\n  position: absolute;\n  width: 15px;\n  height: 15px;\n  background-image: url('./imgs/delete.png');\n  background-size: cover;\n  top: -7px;\n  right: -7px;\n}\n</style>\n"]}]}