{"remainingRequest":"/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/src/views/publish/index.vue?vue&type=style&index=0&id=0361b1a8&scoped=true&lang=css&","dependencies":[{"path":"/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/src/views/publish/index.vue","mtime":1581825653371},{"path":"/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgouY29udGFpbmVyIHsKICBwb3NpdGlvbjogZml4ZWQ7CiAgbGVmdDogMDsKICByaWdodDogMDsKICBib3R0b206IDA7CiAgdG9wOiAwOwogIGJhY2tncm91bmQtY29sb3I6ICNmZmY7Cn0KI3Bvc3RDb250ZW50IHsKICBtYXJnaW4tdG9wOiA0NXB4OwogIGJvcmRlcjogbm9uZTsKICBmb250LXNpemU6IDE2cHg7CiAgd2lkdGg6IDEwMCU7CiAgaGVpZ2h0OiAyMDBweDsKICBib3gtc2l6aW5nOiBib3JkZXItYm94Owp9Ci50ZXh0LWNvdW50IHsKICBmb250LXNpemU6IDE0cHg7CiAgY29sb3I6ICM3MDcwNzA7CiAgcG9zaXRpb246IGFic29sdXRlOwogIHJpZ2h0OiAyMHB4OwogIHRvcDogMjMwcHg7Cn0KI2ZpbGVVcGxvYWRlciB7CiAgZGlzcGxheTogbm9uZTsKfQouc2VsZWN0ZWQtaW1hZ2VzIHsKICBkaXNwbGF5OiBmbGV4OwogIGZsZXgtd3JhcDogd3JhcDsKfQouaW1hZ2UtaXRlbSB7CiAgd2lkdGg6IDEwMHB4OwogIGhlaWdodDogMTAwcHg7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIGJhY2tncm91bmQtc2l6ZTogY292ZXI7CiAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyIGNlbnRlcjsKICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0OwogIG1hcmdpbi1sZWZ0OiAyMHB4OwogIG1hcmdpbi1ib3R0b206IDIwcHg7Cn0KLnBsdXMtaW1hZ2UgewogIHdpZHRoOiAxMDBweDsKICBoZWlnaHQ6IDEwMHB4OwogIHBvc2l0aW9uOiByZWxhdGl2ZTsKICBiYWNrZ3JvdW5kLXNpemU6IDI0cHggMjRweDsKICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXIgY2VudGVyOwogIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7CiAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCcuL2ltZ3MvcGx1cy5wbmcnKTsKICBtYXJnaW4tbGVmdDogMjBweDsKICBib3JkZXI6IDFweCBkYXNoZWQgI2FhYTsKfQouZGVsZXRlLWljb24gewogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICB3aWR0aDogMTVweDsKICBoZWlnaHQ6IDE1cHg7CiAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCcuL2ltZ3MvZGVsZXRlLnBuZycpOwogIGJhY2tncm91bmQtc2l6ZTogY292ZXI7CiAgdG9wOiAtN3B4OwogIHJpZ2h0OiAtN3B4Owp9Cg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/publish","sourcesContent":["<template>\n  <div class=\"container\">\n    <headerbar useRightBtn=\"发表\" :useBack=\"true\" title=\"发表\" @rightBtnClick=\"publish\"></headerbar>\n    <textarea id=\"postContent\"\n      maxlength=\"300\"\n      placeholder=\"分享新鲜事...\"\n      @input=\"oninput\"\n      v-model=\"postContent\"></textarea>\n    <div class=\"text-count\"><span class=\"left-count\">{{textCount}}</span>/300</div>\n    <div class=\"selected-images\">\n      <div class=\"image-item\" v-for=\"(item,index) in imageList\" :key=\"index\" :style=\"imgStyle(item)\">\n        <div class=\"delete-icon\" @click=\"deleteImage(index)\"></div>\n      </div>\n      <div class=\"plus-image\" @click=\"openFileUploader\"></div>\n    </div>\n    <input type=\"file\" id=\"fileUploader\" ref=\"fileUploader\"\n       @change=\"fileChange\"\n       accept=\"image/*\"\n       multiple=\"multiple\"/>\n  </div>\n</template>\n\n<script>\n\nimport headerbar from '@/components/headerbar'\nexport default {\n  name: 'publish',\n  components:{\n    headerbar\n  },\n  data(){\n    return {\n      postContent: '',\n      textCount: 0,\n      imageList:[]\n    }\n  },\n  computed: {\n    imgStyle () {\n      return item => {\n        return {\n          backgroundImage: 'url(' + item.base64 + ')'\n        }\n      }\n    },\n    currentUser () { // 计算属性获取vuex中的currentUser值\n      return this.$store.state.currentUser\n    }\n  },\n  methods:{\n    oninput(){\n      this.textCount = this.postContent.length\n    },\n    openFileUploader(){\n      this.$refs.fileUploader.click()\n    },\n    fileChange (event) {\n      let files = event.target.files; //获取文件对象\n      for (let i = 0; i < files.length; i++) {\n        var reader = new FileReader();\n        reader.readAsDataURL(files[i]); //将图片转换成base64字符串\n        reader.onload = (e) => {\n          let image = new Image() //转换成Image对象，为了获取图片大小\n          image.onload = () => {\n            // 保存到图片列表数组中\n            this.imageList.push({\n              base64: e.target.result,\n              width: image.width,\n              height: image.height\n            })\n          }\n          image.src = e.target.result\n        }\n      }\n      // 每次选完图片后要清除value\n      event.target.value = null\n    },\n    deleteImage(index){\n      this.imageList.splice(index, 1)\n    },\n    publish(){\n      // 图片数据\n      let pics = [];\n      for (let i = 0 ; i < this.imageList.length ; i++) {\n        pics.push({\n          url: this.imageList[i].base64,\n          geo:{\n            width: this.imageList[i].width,\n            height: this.imageList[i].height\n          },\n          large:{\n            url: this.imageList[i].base64\n          }\n        })\n      }\n\n      // 正文数据\n      let obj = {\n        mblog: {\n          id: Date.now(),\n          reposts_count: 0,\n          comments_count: 0,\n          attitudes_count: 0,\n          source: '微博mobile版',\n          text: this.postContent,\n          pics: pics,\n          user: {\n            screen_name: this.currentUser.screen_name,\n            profile_image_url: this.currentUser.profile_image_url,\n            badge:{\n              user_name_certificate: this.currentUser.verified\n            }\n          }\n        }\n      }\n\n      this.$store.dispatch('addPost', obj)\n      mui.toast('发表成功')\n      this.$router.back()\n    }\n  }\n\n}\n</script>\n<style scoped>\n.container {\n  position: fixed;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  top: 0;\n  background-color: #fff;\n}\n#postContent {\n  margin-top: 45px;\n  border: none;\n  font-size: 16px;\n  width: 100%;\n  height: 200px;\n  box-sizing: border-box;\n}\n.text-count {\n  font-size: 14px;\n  color: #707070;\n  position: absolute;\n  right: 20px;\n  top: 230px;\n}\n#fileUploader {\n  display: none;\n}\n.selected-images {\n  display: flex;\n  flex-wrap: wrap;\n}\n.image-item {\n  width: 100px;\n  height: 100px;\n  position: relative;\n  background-size: cover;\n  background-position: center center;\n  background-repeat: no-repeat;\n  margin-left: 20px;\n  margin-bottom: 20px;\n}\n.plus-image {\n  width: 100px;\n  height: 100px;\n  position: relative;\n  background-size: 24px 24px;\n  background-position: center center;\n  background-repeat: no-repeat;\n  background-image: url('./imgs/plus.png');\n  margin-left: 20px;\n  border: 1px dashed #aaa;\n}\n.delete-icon {\n  position: absolute;\n  width: 15px;\n  height: 15px;\n  background-image: url('./imgs/delete.png');\n  background-size: cover;\n  top: -7px;\n  right: -7px;\n}\n</style>\n"]}]}