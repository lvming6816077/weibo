{"remainingRequest":"/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/src/views/comment/index.vue?vue&type=style&index=0&id=7ef80078&scoped=true&lang=css&","dependencies":[{"path":"/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/src/views/comment/index.vue","mtime":1581857746962},{"path":"/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lvming/Desktop/work/personWork/webappBook/weibosource/weibo/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi5jb250YWluZXIgewogIHBvc2l0aW9uOiBmaXhlZDsKICBsZWZ0OiAwOwogIHJpZ2h0OiAwOwogIGJvdHRvbTogMDsKICB0b3A6IDA7CiAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsKfQojcG9zdENvbnRlbnQgewogIG1hcmdpbi10b3A6IDQ1cHg7CiAgYm9yZGVyOiBub25lOwogIGZvbnQtc2l6ZTogMTZweDsKICB3aWR0aDogMTAwJTsKICBoZWlnaHQ6IDIwMHB4OwogIGJveC1zaXppbmc6IGJvcmRlci1ib3g7Cn0KLnRleHQtY291bnQgewogIGZvbnQtc2l6ZTogMTRweDsKICBjb2xvcjogIzcwNzA3MDsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgcmlnaHQ6IDIwcHg7CiAgdG9wOiAyMzBweDsKfQojZmlsZVVwbG9hZGVyIHsKICBkaXNwbGF5OiBub25lOwp9Ci5zZWxlY3RlZC1pbWFnZXMgewogIGRpc3BsYXk6IGZsZXg7CiAgZmxleC13cmFwOiB3cmFwOwp9Ci5pbWFnZS1pdGVtIHsKICB3aWR0aDogMTAwcHg7CiAgaGVpZ2h0OiAxMDBweDsKICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgYmFja2dyb3VuZC1zaXplOiBjb3ZlcjsKICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXIgY2VudGVyOwogIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7CiAgbWFyZ2luLWxlZnQ6IDIwcHg7CiAgbWFyZ2luLWJvdHRvbTogMjBweDsKfQoucGx1cy1pbWFnZSB7CiAgd2lkdGg6IDEwMHB4OwogIGhlaWdodDogMTAwcHg7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIGJhY2tncm91bmQtc2l6ZTogMjRweCAyNHB4OwogIGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlciBjZW50ZXI7CiAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsKICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoJy4vaW1ncy9wbHVzLnBuZycpOwogIG1hcmdpbi1sZWZ0OiAyMHB4OwogIGJvcmRlcjogMXB4IGRhc2hlZCAjYWFhOwp9Ci5kZWxldGUtaWNvbiB7CiAgcG9zaXRpb246IGFic29sdXRlOwogIHdpZHRoOiAxNXB4OwogIGhlaWdodDogMTVweDsKICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoJy4vaW1ncy9kZWxldGUucG5nJyk7CiAgYmFja2dyb3VuZC1zaXplOiBjb3ZlcjsKICB0b3A6IC03cHg7CiAgcmlnaHQ6IC03cHg7Cn0KLnJlcG9zdC1jb250ZW50IHsKICBtYXJnaW4tdG9wOiAxMHB4OwogIG92ZXJmbG93OiBoaWRkZW47Cn0KLnJlcG9zdC1idG4gewogIGZsb2F0OiBsZWZ0OwogIHdpZHRoOiA1MHB4OwogIGhlaWdodDogNTBweDsKICBtYXJnaW4tbGVmdDogMTVweDsKfQoucmVwb3N0LWNoZWNrYm94OmNoZWNrZWQ6OmJlZm9yZSB7CiAgY29sb3I6ICNmZjlmNTIgIWltcG9ydGFudDsKfQoucmVwb3N0LXRleHQgewogIGZsb2F0OiBsZWZ0OwogIG1hcmdpbi10b3A6IDlweDsKICBmb250LXNpemU6IDE2cHg7CiAgY29sb3I6ICMzMzM7CiAgbWFyZ2luLWxlZnQ6IC0xMHB4Owp9Cg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/comment","sourcesContent":["<template>\n  <div class=\"container\">\n    <headerbar useRightBtn=\"提交\" :useBack=\"true\" title=\"评论微博\" @rightBtnClick=\"submit\"></headerbar>\n    <textarea id=\"postContent\"\n      maxlength=\"30\"\n      placeholder=\"请输入文字...\"\n      @input=\"oninput\"\n      v-model=\"postContent\"></textarea>\n    <div class=\"text-count\"><span class=\"left-count\">{{textCount}}</span>/30</div>\n    <div class=\"selected-images\">\n      <div class=\"image-item\" v-for=\"(item,index) in imageList\" :key=\"index\" :style=\"imgStyle(item)\">\n        <div class=\"delete-icon\" @click=\"deleteImage(index)\"></div>\n      </div>\n      <div v-if=\"imageList.length == 0\" class=\"plus-image\" @click=\"openFileUploader\"></div>\n    </div>\n    <input type=\"file\" id=\"fileUploader\" ref=\"fileUploader\"\n       @change=\"fileChange\"\n       accept=\"image/*\"\n       multiple=\"multiple\"/>\n    <div class=\"repost-content\">\n      <div class=\"mui-checkbox repost-btn\">\n        <input class=\"repost-checkbox\" value=\"\" v-model=\"isRepost\" type=\"checkbox\">\n      </div>\n      <div class=\"repost-text\">同时转发</div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport headerbar from '@/components/headerbar'\nexport default {\n  name: 'comment',\n  components:{\n    headerbar\n  },\n  data(){\n    return {\n      postContent: '',\n      textCount: 0,\n      imageList: [],\n      isRepost: false\n    }\n  },\n  computed: {\n    imgStyle () {\n      return item => {\n        return {\n          backgroundImage: 'url(' + item.base64 + ')'\n        }\n      }\n    },\n    currentUser(){\n      return this.$store.state.currentUser\n    },\n    toRepostData(){\n      if (this.$store.state.toRepostData) {\n        return this.$store.state.toRepostData.mblog\n      }\n\n      return null\n      \n    }\n  },\n  methods:{\n    oninput(){\n      this.textCount = this.postContent.length\n    },\n    openFileUploader(){\n      if (this.imageList.length == 0) {\n        this.$refs.fileUploader.click()\n      }\n      \n    },\n    fileChange (event) {\n      let files = event.target.files; //获取文件对象\n      for (let i = 0; i < files.length; i++) {\n        var reader = new FileReader();\n        reader.readAsDataURL(files[i]); //将图片转换成base64字符串\n        reader.onload = (e) => {\n          let image = new Image() //转换成Image对象，为了获取图片大小\n          image.onload = () => {\n            // 保存到图片列表数组中\n            this.imageList.push({\n              base64: e.target.result,\n              width: image.width,\n              height: image.height\n            })\n          }\n          image.src = e.target.result\n        }\n      }\n      // 每次选完图片后要清除value\n      event.target.value = null\n    },\n    deleteImage(index){\n      this.imageList.splice(index, 1)\n    },\n    submit(){\n      let text = this.postContent\n      let id = Date.now() //指定唯一id\n      if (this.imageList.length > 0) {//判断是否选择了图片\n        let str = '<a data-preview-src=\"$$src\" data-preview-group=\"$$id\"><span class=\"surl-text\">评论配图</span></a>'\n        str = str.replace('$$src', this.imageList[0].base64).replace('$$id', id) // 使用base64字符串替换\n        text += str\n      }\n\n      let obj = {\n        created_at: Date.now(),\n        id: id,\n        like_count: 0,\n        text: text,\n        more_info_users: [],\n        user: {\n          screen_name: this.currentUser.screen_name,\n          profile_image_url: this.currentUser.profile_image_url,\n          badge:{\n            user_name_certificate: this.currentUser.verified\n          }\n        }\n      }\n\n      this.$store.dispatch('addComment',obj)\n      mui.toast('评论成功')\n\n      if (this.isRepost) {\n        this.doRepost()\n      }\n      this.$router.back()\n    },\n    doRepost(){\n      let obj = {\n        mblog: {\n          id: Date.now(),\n          attitides_count: 0,\n          reposts_count: 0,\n          comments_count: 0,\n          source: '微博mobile版',\n          text: this.postContent,\n          pics:[],\n          retweeted_status: this.toRepostData,\n          user: {\n            screen_name: this.currentUser.screen_name,\n            profile_image_url: this.currentUser.profile_image_url,\n            badge:{\n              user_name_certificate: this.currentUser.verified\n            }\n          }\n        }\n      }\n\n      this.$store.dispatch('addPost',obj)\n    }\n  }\n\n}\n</script>\n<style scoped>\n.container {\n  position: fixed;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  top: 0;\n  background-color: #fff;\n}\n#postContent {\n  margin-top: 45px;\n  border: none;\n  font-size: 16px;\n  width: 100%;\n  height: 200px;\n  box-sizing: border-box;\n}\n.text-count {\n  font-size: 14px;\n  color: #707070;\n  position: absolute;\n  right: 20px;\n  top: 230px;\n}\n#fileUploader {\n  display: none;\n}\n.selected-images {\n  display: flex;\n  flex-wrap: wrap;\n}\n.image-item {\n  width: 100px;\n  height: 100px;\n  position: relative;\n  background-size: cover;\n  background-position: center center;\n  background-repeat: no-repeat;\n  margin-left: 20px;\n  margin-bottom: 20px;\n}\n.plus-image {\n  width: 100px;\n  height: 100px;\n  position: relative;\n  background-size: 24px 24px;\n  background-position: center center;\n  background-repeat: no-repeat;\n  background-image: url('./imgs/plus.png');\n  margin-left: 20px;\n  border: 1px dashed #aaa;\n}\n.delete-icon {\n  position: absolute;\n  width: 15px;\n  height: 15px;\n  background-image: url('./imgs/delete.png');\n  background-size: cover;\n  top: -7px;\n  right: -7px;\n}\n.repost-content {\n  margin-top: 10px;\n  overflow: hidden;\n}\n.repost-btn {\n  float: left;\n  width: 50px;\n  height: 50px;\n  margin-left: 15px;\n}\n.repost-checkbox:checked::before {\n  color: #ff9f52 !important;\n}\n.repost-text {\n  float: left;\n  margin-top: 9px;\n  font-size: 16px;\n  color: #333;\n  margin-left: -10px;\n}\n</style>\n"]}]}